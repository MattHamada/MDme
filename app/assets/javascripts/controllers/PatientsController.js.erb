app.controller('PatientsController', ['$scope', '$http', '$upload', 'AuthInterceptor', 'LocalService', function($scope, $http, $upload, AuthInterceptor, LocalService) {
  $scope.patient = {};
  $scope.avatar = [];
  $scope.patient.id = LocalService.get('userId');
  var req = {
    method: 'GET',
    url: '/patients/' + $scope.patient.id + '.json',
    headers: $http.defaults.headers.common
  };
  req = AuthInterceptor.request(req);
  $http(req)
    .success(function(data) {
      $scope.patient = data.patient;
      console.log($scope.patient);
    }).error(function(err) {
      console.log(err);
    });

  $scope.updatePatient = function() {
    var req = {
      method: 'PATCH',
      url: '/patients/' + $scope.patient.id,
      headers: $http.defaults.headers.patch,
      fields: {
        first_name: $scope.patient.first_name,
        last_name: $scope.patient.last_name
      },
      file: $scope.avatar,
      fileFormDataName: 'avatar'
    };
    req = AuthInterceptor.request(req);
    $upload.upload(req);
//    $http(req)
//        .success(function(data) {
//          console.log(data);
//        }).error(function(error) {
//          console.log(error);
//        });
  };


}]);