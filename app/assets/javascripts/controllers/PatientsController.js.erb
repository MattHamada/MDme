app.controller('PatientsController', ['$scope', '$http', '$upload', '$state', 'AuthInterceptor', 'LocalService', 'flash', function($scope, $http, $upload, $state, AuthInterceptor, LocalService, flash) {
  $scope.patient = {};
  $scope.avatar = [];
  $scope.patient.id = LocalService.get('userId');
  var req = {
    method: 'GET',
    url: '/patients/' + $scope.patient.id + '.json',
    headers: $http.defaults.headers.common
  };
  req = AuthInterceptor.request(req);
  $http(req)
    .success(function(data) {
      $scope.patient = data.patient;
    }).error(function(err) {
      console.log(err);
    });

  $scope.updatePatient = function() {
    var req = {
      method: 'PATCH',
      url: '/patients/' + $scope.patient.id,
      headers: $http.defaults.headers.patch,
      fields: $scope.patient,
      formDataAppender: function(fd, key, val) {
        fd.append('patient['+key+']', val);
      },
      file: $scope.avatar,
      fileFormDataName: 'patient[avatar]'
    };
    req = AuthInterceptor.request(req);
    $upload.upload(req)
        .success(function(data) {
          flash.success = data.status;
          $state.go('user.home', flash);
        }).error(function(err) {
          flash.error = err.errors;
        });
  };


}]);